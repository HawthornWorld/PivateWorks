{"remainingRequest":"/Users/mrc/jsProj/PivateWorks/raymanga/node_modules/babel-loader/lib/index.js!/Users/mrc/jsProj/PivateWorks/raymanga/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/mrc/jsProj/PivateWorks/raymanga/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mrc/jsProj/PivateWorks/raymanga/src/pages/Detail.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mrc/jsProj/PivateWorks/raymanga/src/pages/Detail.vue","mtime":1553517088000},{"path":"/Users/mrc/jsProj/PivateWorks/raymanga/node_modules/cache-loader/dist/cjs.js","mtime":1551613478189},{"path":"/Users/mrc/jsProj/PivateWorks/raymanga/node_modules/babel-loader/lib/index.js","mtime":1551613443346},{"path":"/Users/mrc/jsProj/PivateWorks/raymanga/node_modules/cache-loader/dist/cjs.js","mtime":1551613478189},{"path":"/Users/mrc/jsProj/PivateWorks/raymanga/node_modules/vue-loader/lib/index.js","mtime":1551613480809}],"contextDependencies":[],"result":["import _parseInt from \"/Users/mrc/jsProj/PivateWorks/raymanga/node_modules/@babel/runtime-corejs2/core-js/parse-int\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport util from '../vendors/util.js';\nimport lang from '../vendors/lang.js';\nimport ChapterStar from '../components/ChapterStar.vue';\nimport BottomPanel from '../components/BottomPanel.vue';\nimport NavBar from '../components/NavBar.vue';\nexport default {\n  name: 'detail',\n  data: function data() {\n    return {\n      chapterid: _parseInt(util.getQuery('chapterid')),\n      bookid: _parseInt(util.getQuery('bookid')),\n      chapterNum: _parseInt(util.getQuery('chapternum')) + 1,\n      pageList: [],\n      userLang: {},\n      chapterIdArr: [],\n      chapterNumArr: [],\n      isToBottom: false\n    };\n  },\n  // computed: {\n  //   currChapternum() {\n  //     return parseInt(this.chapterNum) + 1;\n  //   },\n  // },\n  created: function created() {\n    this.getChapterList();\n    this.getBookInfo(); //获取用户设备语言 包含常规浏览器和ie浏览器\n\n    var langKey = (navigator.language || navigator.userLanguage).slice(0, 2); //切换ui至相应语言\n\n    this.userLang = lang[langKey];\n  },\n  mounted: function mounted() {\n    //动态设置fixed元素的宽度\n    var dom = document.getElementsByClassName('toggle-chapter')[0];\n    dom.style.width = document.body.clientWidth + 'px'; // 调用统计章节pv函数\n\n    this.detailPvHandle();\n    window.addEventListener('scroll', this.handleScroll, true);\n  },\n  methods: {\n    /**\n     * 统计阅读页pv函数,章节id可从链接获取,ChapterStar.vue有获取cookie uuid工具函数\n     */\n    detailPvHandle: function detailPvHandle() {\n      console.log('detail pv');\n    },\n\n    /**\n     * 统计完成章节阅读用户\n     */\n    chapterDoneHandle: function chapterDoneHandle() {\n      console.log('chapter done');\n    },\n    handleScroll: function handleScroll() {\n      //判断页面是否拉到底部\n      var scrollDom = this.$refs.container;\n      var distance = scrollDom.scrollHeight - document.body.scrollTop - document.body.clientHeight;\n\n      if (distance < 700 && !this.isToBottom) {\n        // 在距离底部400px之内,调用统计完成章节阅读用户函数\n        this.chapterDoneHandle();\n        console.log(new Date());\n        this.isToBottom = true;\n      }\n    },\n\n    /**\n     * 获取章节详情\n     */\n    getChapterList: function getChapterList() {\n      var _this = this;\n\n      var getChapterDetail = '//previewapi.raymangaapp.com/previewapi/v1/common/getChapterDetail';\n      this.$axios.post(getChapterDetail, {\n        book_id: _parseInt(this.bookid),\n        chapter_id: _parseInt(this.chapterid)\n      }).then(function (res) {\n        /**\n         * 状态码\n         * 1     ：成功\n         * 2000  ：常规错误\n         * 2001  ：参数错误\n         * 2002  ：数据库连接错误\n         */\n        var _res$data = res.data,\n            code = _res$data.code,\n            pageList = _res$data.pageList;\n\n        if (code === 1) {\n          _this.pageList = pageList;\n        } else if (code === 2000) {\n          _this.$toast('常规错误(2000)');\n        } else if (code === 2001) {\n          _this.$toast('参数错误(2001)');\n        } else if (code === 2002) {\n          _this.$toast('数据库连接错误(2002)');\n        }\n      }).catch(function (error) {\n        _this.$toast('网络繁忙，请稍后再试');\n      });\n    },\n\n    /**\n     * 获取chapterid arr\n     */\n    getBookInfo: function getBookInfo() {\n      var _this2 = this;\n\n      var getBookInfo = '//previewapi.raymangaapp.com/previewapi/v1/common/getBookInfo';\n      this.$axios.post(getBookInfo, {\n        book_id: this.bookid\n      }).then(function (res) {\n        var _res$data2 = res.data,\n            code = _res$data2.code,\n            bookInfo = _res$data2.bookInfo;\n\n        if (code === 1) {\n          // 本书章节id数组\n          bookInfo.chapter_list.forEach(function (item) {\n            _this2.chapterIdArr.push(item.chapter_id);\n\n            _this2.chapterNumArr.push(item.chapter_number);\n          });\n          console.log(_this2.chapterNumArr);\n        }\n      }).catch(function (error) {\n        _this2.$toast('网络繁忙，请稍后再试');\n      });\n    },\n\n    /**\n     * 切换章节\n     */\n    prevChapter: function prevChapter() {\n      var currChapterIdx = this.chapterIdArr.indexOf(this.chapterid);\n      if (currChapterIdx === 0) return; //按章节ID切换章节\n\n      this.chapterid = this.chapterIdArr[currChapterIdx - 1];\n      this.chapterNum = this.chapterNumArr[currChapterIdx - 1] + 1;\n      this.getChapterList(); //切换章节时滚动视口到顶部\n\n      document.body.scrollTop = 0;\n    },\n    nextChapter: function nextChapter() {\n      var currChapterIdx = this.chapterIdArr.indexOf(this.chapterid);\n      var chapterLen = this.chapterIdArr.length;\n      if (currChapterIdx >= chapterLen - 1) return;\n      this.chapterid = this.chapterIdArr[currChapterIdx + 1];\n      this.chapterNum = this.chapterNumArr[currChapterIdx + 1] + 1;\n      this.getChapterList();\n      document.body.scrollTop = 0;\n    }\n  },\n  components: {\n    BottomPanel: BottomPanel,\n    ChapterStar: ChapterStar,\n    NavBar: NavBar\n  }\n};",{"version":3,"sources":["Detail.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"detail-wrapper\">\n    <NavBar :chapterNum=\"chapterNum\"></NavBar>\n    <transition name=\"fade\">\n      <div class=\"page-list\" ref=\"container\">\n        <ul class=\"list\">\n          <li v-for=\"(item,idx) in pageList\" :key=\"idx\">\n            <img :src=\"`//img1.raymangaapp.com${item.image_url}`\" v-lazy=\"`//img1.raymangaapp.com${item.image_url}`\" alt=\"\">\n          </li>\n        </ul>\n      </div>\n    </transition>\n    <ChapterStar :userLang=\"userLang\"></ChapterStar>\n    <BottomPanel class=\"download\" :userLang=\"userLang\"></BottomPanel>\n    <div class=\"toggle-chapter\">\n      <span class=\"prev\" @click=\"prevChapter\"></span>\n      <span class=\"num\">Ch.{{chapterNum}}</span>\n      <span class=\"next\" @click=\"nextChapter\"></span>\n    </div>\n\n  </div>\n</template>\n\n<script>\nimport util from '../vendors/util.js';\nimport lang from '../vendors/lang.js';\nimport ChapterStar from '../components/ChapterStar.vue';\nimport BottomPanel from '../components/BottomPanel.vue';\nimport NavBar from '../components/NavBar.vue';\n\nexport default {\n  name: 'detail',\n  data() {\n    return {\n      chapterid: parseInt(util.getQuery('chapterid')),\n      bookid: parseInt(util.getQuery('bookid')),\n      chapterNum: parseInt(util.getQuery('chapternum')) + 1,\n      pageList: [],\n      userLang: {},\n      chapterIdArr: [],\n      chapterNumArr: [],\n      isToBottom: false\n    };\n  },\n  // computed: {\n  //   currChapternum() {\n  //     return parseInt(this.chapterNum) + 1;\n  //   },\n  // },\n  created() {\n    this.getChapterList();\n    this.getBookInfo();\n    //获取用户设备语言 包含常规浏览器和ie浏览器\n    let langKey = (navigator.language || navigator.userLanguage).slice(0, 2);\n    //切换ui至相应语言\n    this.userLang = lang[langKey];\n  },\n  mounted() {\n    //动态设置fixed元素的宽度\n    let dom = document.getElementsByClassName('toggle-chapter')[0];\n    dom.style.width = document.body.clientWidth + 'px';\n    // 调用统计章节pv函数\n    this.detailPvHandle();\n\n    window.addEventListener('scroll', this.handleScroll, true);\n  },\n  methods: {\n    /**\n     * 统计阅读页pv函数,章节id可从链接获取,ChapterStar.vue有获取cookie uuid工具函数\n     */\n    detailPvHandle() {\n      console.log('detail pv');\n    },\n    /**\n     * 统计完成章节阅读用户\n     */\n    chapterDoneHandle() {\n      console.log('chapter done');\n    },\n    handleScroll() {\n      //判断页面是否拉到底部\n      let scrollDom = this.$refs.container;\n      let distance =\n        scrollDom.scrollHeight -\n        document.body.scrollTop -\n        document.body.clientHeight;\n      if (distance < 700 && !this.isToBottom) {\n        // 在距离底部400px之内,调用统计完成章节阅读用户函数\n        this.chapterDoneHandle();\n        console.log(new Date())\n        this.isToBottom = true\n      }\n    },\n    /**\n     * 获取章节详情\n     */\n    getChapterList() {\n      const getChapterDetail =\n        '//previewapi.raymangaapp.com/previewapi/v1/common/getChapterDetail';\n\n      this.$axios\n        .post(getChapterDetail, {\n          book_id: parseInt(this.bookid),\n          chapter_id: parseInt(this.chapterid),\n        })\n        .then(res => {\n          /**\n           * 状态码\n           * 1     ：成功\n           * 2000  ：常规错误\n           * 2001  ：参数错误\n           * 2002  ：数据库连接错误\n           */\n          const { code, pageList } = res.data;\n          if (code === 1) {\n            this.pageList = pageList;\n          } else if (code === 2000) {\n            this.$toast('常规错误(2000)');\n          } else if (code === 2001) {\n            this.$toast('参数错误(2001)');\n          } else if (code === 2002) {\n            this.$toast('数据库连接错误(2002)');\n          }\n        })\n        .catch(error => {\n          this.$toast('网络繁忙，请稍后再试');\n        });\n    },\n    /**\n     * 获取chapterid arr\n     */\n    getBookInfo() {\n      const getBookInfo =\n        '//previewapi.raymangaapp.com/previewapi/v1/common/getBookInfo';\n      this.$axios\n        .post(getBookInfo, {\n          book_id: this.bookid,\n        })\n        .then(res => {\n          const { code, bookInfo } = res.data;\n          if (code === 1) {\n            // 本书章节id数组\n            bookInfo.chapter_list.forEach(item => {\n              this.chapterIdArr.push(item.chapter_id);\n              this.chapterNumArr.push(item.chapter_number);\n            });\n            console.log(this.chapterNumArr);\n          }\n        })\n        .catch(error => {\n          this.$toast('网络繁忙，请稍后再试');\n        });\n    },\n    /**\n     * 切换章节\n     */\n\n    prevChapter() {\n      let currChapterIdx = this.chapterIdArr.indexOf(this.chapterid);\n      if (currChapterIdx === 0) return;\n      //按章节ID切换章节\n      this.chapterid = this.chapterIdArr[currChapterIdx - 1];\n      this.chapterNum = this.chapterNumArr[currChapterIdx - 1]+ 1;\n      this.getChapterList();\n      //切换章节时滚动视口到顶部\n      document.body.scrollTop = 0;\n    },\n    nextChapter() {\n      let currChapterIdx = this.chapterIdArr.indexOf(this.chapterid);\n      let chapterLen = this.chapterIdArr.length;\n      if (currChapterIdx >= chapterLen - 1) return;\n\n      this.chapterid = this.chapterIdArr[currChapterIdx + 1];\n      this.chapterNum = this.chapterNumArr[currChapterIdx + 1] + 1;\n      this.getChapterList();\n      document.body.scrollTop = 0;\n    },\n  },\n  components: {\n    BottomPanel,\n    ChapterStar,\n    NavBar,\n  },\n};\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style lang=\"scss\" scoped>\n@import '../assets/scss/common.scss';\n.detail-wrapper {\n  padding: rem(170px) 0 120px;\n  width: 100%;\n}\n.page-list .list li {\n  width: 100%;\n  img {\n    width: 100%;\n    display: block;\n  }\n}\n.download {\n  bottom: rem(150px);\n}\n\n.toggle-chapter {\n  position: fixed;\n  bottom: 0;\n  width: 100%;\n  height: rem(150px);\n  background: #f4f4f4;\n  border-top: 1px solid #b2b2b2;\n  padding: 0 rem(300px);\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: space-between;\n\n  .prev {\n    display: inline-block;\n    width: rem(64px);\n    height: rem(64px);\n    background: url(#{$base}/ic_reader_navigation_previous.png) center center\n      no-repeat/100%;\n  }\n  .num {\n    padding: rem(20px) rem(15px);\n    box-sizing: border-box;\n    border-radius: 6px;\n    background: #e3e3e3;\n  }\n  .next {\n    display: inline-block;\n    width: rem(64px);\n    height: rem(64px);\n    background: url(#{$base}/ic_reader_navigation_next.png) center center\n      no-repeat/100%;\n  }\n}\n// .fade-enter-active,\n// .fade-leave-active {\n//   transition: opacity .5s;\n// }\n\n// .fade-enter,\n// .fade-leave-to\n// /* .scalein-leave-active below version 2.1.8 */\n\n//  {\n//   opacity: 0;\n// }\n</style>\n"],"sourceRoot":"src/pages"}]}
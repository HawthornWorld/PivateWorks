{"remainingRequest":"/Users/mrc/jsProj/PivateWorks/raymanga/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mrc/jsProj/PivateWorks/raymanga/src/components/ChapterStar.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mrc/jsProj/PivateWorks/raymanga/src/components/ChapterStar.vue","mtime":1553363562000},{"path":"/Users/mrc/jsProj/PivateWorks/raymanga/node_modules/cache-loader/dist/cjs.js","mtime":1551613478189},{"path":"/Users/mrc/jsProj/PivateWorks/raymanga/node_modules/babel-loader/lib/index.js","mtime":1551613443346},{"path":"/Users/mrc/jsProj/PivateWorks/raymanga/node_modules/cache-loader/dist/cjs.js","mtime":1551613478189},{"path":"/Users/mrc/jsProj/PivateWorks/raymanga/node_modules/vue-loader/lib/index.js","mtime":1551613480809}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport util from '../vendors/util.js';\n\nconst BASE_URL = '../assets/images';\nexport default {\n  name: 'star',\n  data() {\n    return {\n      chapterId: util.getQuery('chapterid'),\n      userScore: 0,\n      comment: '',\n      cookieId: '',\n      placeHolder: this.userLang.starCnt,\n      starObj: [\n        {\n          txt: this.userLang.starC,\n          score: 1,\n        },\n        {\n          txt: this.userLang.starB,\n          score: 2,\n        },\n        {\n          txt: this.userLang.starA,\n          score: 3,\n        },\n      ],\n    };\n  },\n  props: {\n    userLang: {\n      type: Object,\n      default: {}\n    }\n  },\n  mounted() {\n    //判断cookie中是否有uuid，若无，则写入\n    this.cookieId = this.getCookie('uuid');\n    if (!this.cookieId) {\n      this.cookieId = this.generateUid();\n      this.setCookie('uuid', this.cookieId, 365);\n    }\n  },\n  methods: {\n    starHandle(e) {\n      //star时高亮星星\n      let doms = document.getElementsByClassName('bg');\n      Array.prototype.slice.call(doms).forEach(item => {\n        item.classList.remove('light');\n      });\n      e.target.classList.add('light');\n\n      //获取用户分数\n      this.userScore = parseInt(e.target.dataset.score);\n    },\n    /**\n     * 获取输入框内容\n     */\n    getInput(e) {\n      this.comment = e.target.value;\n    },\n    /**\n     * 获取cookie标识\n     */\n    getCookie(name) {\n      let arr,\n        reg = new RegExp('(^| )' + name + '=([^;]*)(;|$)');\n      if ((arr = document.cookie.match(reg))) {\n        return unescape(arr[2]);\n      } else {\n        return ''\n      }\n    },\n    setCookie(name, value, expiredays) {\n      var exdate = new Date();\n      exdate.setDate(exdate.getDate() + expiredays);\n      document.cookie =\n        name +\n        '=' +\n        escape(value) +\n        (expiredays == null ? '' : ';expires=' + exdate.toGMTString());\n    },\n    /**\n     * 随机生成无重复字符串\n     */\n    generateUid() {\n      let s = () => {\n        return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n      };\n      return (\n        s() + s() + '-' + s() + '-' + s() + '-' + s() + '-' + s() + s() + s()\n      );\n    },\n    /**\n     * 提交评分和评论\n     */\n    submitHandle() {\n      // 点击提交,一起提交star && comment,star必选，comment可选\n      if (!this.userScore) {\n        //提示star必选\n        this.$toast('请为本章节打分');\n        return;\n      }\n      //提交\n      this.submitStar();\n    },\n    /**\n     * 提交评分和评论\n     */\n    submitStar() {\n      \n      const markBook =\n        '//previewapi.raymangaapp.com/previewapi/v1/common/markBook';\n      this.$axios\n        .post(markBook, {\n          cookie_id: this.cookieId,\n          chapter_id: parseInt(this.chapterId),\n          score: this.userScore,\n          suggestion: this.comment || '',\n        })\n        .then(res => {\n          /**\n           * 状态码\n           * 1     ：成功\n           * 2000  ：常规错误\n           * 2001  ：参数错误\n           * 2002  ：数据库连接错误\n           */\n          const { code } = res.data;\n          if (code === 1) {\n            this.$toast('提交成功')\n          } else if (code === 2000) {\n            this.$toast('常规错误(2000)');\n          } else if (code === 2001) {\n            this.$toast('参数错误(2001)');\n          } else if (code === 2002) {\n            this.$toast('数据库连接错误(2002)');\n          }\n        })\n        .catch(error => {\n          this.$toast('网络繁忙，请稍后再试');\n        });\n    },\n  },\n};\n",{"version":3,"sources":["ChapterStar.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ChapterStar.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"star-wrapper\">\n    <div class=\"title\">{{userLang.starTitle}}</div>\n    <div class=\"desc\">{{userLang.starSubTitle}}</div>\n    <div class=\"star\">\n      <ul class=\"list\">\n        <li v-for=\"(item,idx) in starObj\">\n          <span class=\"bg\" :data-score=\"item.score\" @click=\"starHandle\"></span>\n          <span class=\"txt\">{{item.txt}}</span>\n        </li>\n      </ul>\n    </div>\n    <div class=\"text\">\n      <textarea type=\"text\" rows=\"4\" :placeholder=\"placeHolder\" v-model.trim=\"comment\" @keyup.stop=\"getInput\">\n      </textarea>\n    </div>\n    <div class=\"submit\" @click=\"submitHandle\">{{userLang.submitBtn}}</div>\n  </div>\n</template>\n\n<script>\nimport util from '../vendors/util.js';\n\nconst BASE_URL = '../assets/images';\nexport default {\n  name: 'star',\n  data() {\n    return {\n      chapterId: util.getQuery('chapterid'),\n      userScore: 0,\n      comment: '',\n      cookieId: '',\n      placeHolder: this.userLang.starCnt,\n      starObj: [\n        {\n          txt: this.userLang.starC,\n          score: 1,\n        },\n        {\n          txt: this.userLang.starB,\n          score: 2,\n        },\n        {\n          txt: this.userLang.starA,\n          score: 3,\n        },\n      ],\n    };\n  },\n  props: {\n    userLang: {\n      type: Object,\n      default: {}\n    }\n  },\n  mounted() {\n    //判断cookie中是否有uuid，若无，则写入\n    this.cookieId = this.getCookie('uuid');\n    if (!this.cookieId) {\n      this.cookieId = this.generateUid();\n      this.setCookie('uuid', this.cookieId, 365);\n    }\n  },\n  methods: {\n    starHandle(e) {\n      //star时高亮星星\n      let doms = document.getElementsByClassName('bg');\n      Array.prototype.slice.call(doms).forEach(item => {\n        item.classList.remove('light');\n      });\n      e.target.classList.add('light');\n\n      //获取用户分数\n      this.userScore = parseInt(e.target.dataset.score);\n    },\n    /**\n     * 获取输入框内容\n     */\n    getInput(e) {\n      this.comment = e.target.value;\n    },\n    /**\n     * 获取cookie标识\n     */\n    getCookie(name) {\n      let arr,\n        reg = new RegExp('(^| )' + name + '=([^;]*)(;|$)');\n      if ((arr = document.cookie.match(reg))) {\n        return unescape(arr[2]);\n      } else {\n        return ''\n      }\n    },\n    setCookie(name, value, expiredays) {\n      var exdate = new Date();\n      exdate.setDate(exdate.getDate() + expiredays);\n      document.cookie =\n        name +\n        '=' +\n        escape(value) +\n        (expiredays == null ? '' : ';expires=' + exdate.toGMTString());\n    },\n    /**\n     * 随机生成无重复字符串\n     */\n    generateUid() {\n      let s = () => {\n        return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);\n      };\n      return (\n        s() + s() + '-' + s() + '-' + s() + '-' + s() + '-' + s() + s() + s()\n      );\n    },\n    /**\n     * 提交评分和评论\n     */\n    submitHandle() {\n      // 点击提交,一起提交star && comment,star必选，comment可选\n      if (!this.userScore) {\n        //提示star必选\n        this.$toast('请为本章节打分');\n        return;\n      }\n      //提交\n      this.submitStar();\n    },\n    /**\n     * 提交评分和评论\n     */\n    submitStar() {\n      \n      const markBook =\n        '//previewapi.raymangaapp.com/previewapi/v1/common/markBook';\n      this.$axios\n        .post(markBook, {\n          cookie_id: this.cookieId,\n          chapter_id: parseInt(this.chapterId),\n          score: this.userScore,\n          suggestion: this.comment || '',\n        })\n        .then(res => {\n          /**\n           * 状态码\n           * 1     ：成功\n           * 2000  ：常规错误\n           * 2001  ：参数错误\n           * 2002  ：数据库连接错误\n           */\n          const { code } = res.data;\n          if (code === 1) {\n            this.$toast('提交成功')\n          } else if (code === 2000) {\n            this.$toast('常规错误(2000)');\n          } else if (code === 2001) {\n            this.$toast('参数错误(2001)');\n          } else if (code === 2002) {\n            this.$toast('数据库连接错误(2002)');\n          }\n        })\n        .catch(error => {\n          this.$toast('网络繁忙，请稍后再试');\n        });\n    },\n  },\n};\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style lang=\"scss\" scoped>\n@import '../assets/scss/common.scss';\n.star-wrapper {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  color: #5a5a5a;\n  padding: 0 rem(128px);\n  box-sizing: border-box;\n\n  .title {\n    font-size: rem(48px);\n    font-weight: bold;\n  }\n  .desc {\n    font-size: rem(36px);\n    margin: rem(50px) 0 rem(100px);\n  }\n  .star {\n    .list {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n    }\n    li {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      width: 90px;\n      .bg {\n        display: inline-block;\n        width: rem(72px);\n        height: rem(72px);\n        background-image: url(#{$base}/ic_reader_navigation_favorite.png);\n        background-size: 100%;\n        background-position: center center;\n        background-repeat: no-repeat;\n      }\n      .bg.light {\n        background-image: url(#{$base}/ic_favorite_highlight.png);\n      }\n      .txt {\n        color: #5a5a5a;\n        font-size: rem(40px);\n        font-weight: bold;\n      }\n    }\n  }\n  .text {\n    width: 100%;\n    margin: rem(80px) 0 rem(42px);\n    textarea {\n      width: 100%;\n      height: rem(278px);\n      color: #7e7e7e;\n      background: #e8e8e8;\n      border: none;\n      outline: none;\n      resize: none;\n      padding: rem(20px) rem(28px);\n    }\n  }\n  .submit {\n    width: rem(336px);\n    height: rem(110px);\n    line-height: rem(110px);\n    color: #fff;\n    font-size: rem(36px);\n    background: #ff6666;\n    border-radius: rem(110px);\n    text-align: center;\n  }\n}\n</style>\n"]}]}
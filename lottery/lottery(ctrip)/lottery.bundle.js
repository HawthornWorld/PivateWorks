"use strict";define(["modulebase","UIAlert","mktutil","cCommonStore","cMemberService","cShell","//pages.c-ctrip.com/amsweb/tools/qrcode.min.js","//pages.c-ctrip.com/amsweb/tools/JsBarcode.code128.min.js"],function(e,t,i,o,r,n,a,s){var d=console.log.bind(console),c=i.getUnionObj(),l=o.UserStore.getInstance(),p=function(){return l&&l.isLogin()}(),u=function(){var e=!!navigator.userAgent.match(/micromessenger/i);return function(){return e}}(),h=function(){var e="wechatmp"===Lizard.P("platform"),t=u()&&navigator.userAgent.match(/miniprogram/i);return function(){return e||t||"miniprogram"===window.__wxjs_environment}}(),m={NOSERIAL:"尚无券码",ERROR:"活动繁忙，请稍后再试",NOTOKEN:"通过验证后即可参与",SCENE_ERROR:{40004:"活动还未开始哦，敬请期待",40005:"您来晚啦，活动已经结束了"}},f={ERROR:-1,SUCCESS:0,UNDERSTOCK:10003,UNBOUND_MOBILE:40007,USER_NOT_LOGIN:40006,RULE_CHECK_FAILED:40011,USER_DUPLICATE_JOIN:40012,MOBILE_DUPLICATE_JOIN:40013,CLIENT_DUPLICATE_JOIN:40014,NOT_QULIFIED:40026,DAY_DUPLICATE:40028,WEEK_DUPLICATE:40029,MONTH_DUPLICATE:40030},g={sliderShow:"请按住滑块儿，拖动到最后",cycle:20,speed:120,btnTxt:"知道了",understock_info:"参与活动的人太多了，请刷新重试",understock_text:"知道了",getPrize_0_info:"好可惜，差一点点就中奖了",getPrize_0_text:"知道了",getPrize_1_info:"恭喜您抽中",getPrize_1_text:"去使用",getPrize_2_info:"恭喜您抽中",getPrize_2_text:"去填写寄送地址",getPrize_3_info:"恭喜您抽中",getPrize_3_text:"去查看",duplicate_info:"您已经参与过了哦",duplicate_text:"知道了",notQulified_info:"不好意思，您不符合参与条件哦",notQulified_text:"知道了",fail_info:"参与活动的人太多了，刷新重试",fail_text:"刷新重试",bindMobile_info:"需要先绑定手机哦",bindMobile_text:"去绑定",needLogin_info:"登录后即可参与",needLogin_text:"去登录",dayDuplicate_info:"今天已经参与过了哦，明天再来吧",weekDuplicate_info:"这周已经参与过了哦，下周再来吧",monthDuplicate_info:"本月已经参与过了哦，下月再来吧"},b={chanceBgColor:"",chanceFontColor:"",lotteryBgColor:"",lotteryBgImage:"",tblBgColor:"",tblBgImage:"",tblBorderSpace:"",tblItemShadow:"",tblItemBgColor:"",tblItemFontColor:"",centerBtnImage:"",isPrizeBtn:!1,otherStyle:""},x={Coupon:"//pages.c-ctrip.com/activitysetupapp/webresource2/component/lottery/coupon.png",ThirdCoupon:"//pages.c-ctrip.com/activitysetupapp/webresource2/component/lottery/coupon.png",Point:"//pages.c-ctrip.com/activitysetupapp/webresource2/component/lottery/point.png",Holder:"//pic.c-ctrip.com/vacation_v2/h5/group_travel/no_product_pic.png"};return _.inherit(e,{basic:function(){return{fat:{SOA_PORT:"13458",ENV:"fat",aid:1e4,sid:1e4},pro:{SOA_PORT:"13458",ENV:"pro",aid:"100319",sid:"1001736"}}[this.getenv()]},init:function(){var e=this;this.data=_.extend({},b,this.data),this.template='<div id="component_<%=componentId%>" class="wrap lottery"><div id="container_<%=componentId%>"><p class="chance J_chance">您剩余<em>1</em>次抽奖机会</p> <%if (isPrizeBtn) {%> <p class="btn-prize J_prize" id=mktact_lottery_myprize><span>我的奖品</span></p> <%}%> <table class="tbl J_tbl"></table><div class="m-prize J_prize_list"></div></div><div id="warn_<%=componentId%>" class=warning>您来晚啦，活动已结束啦！</div><style>#component_<%=componentId%>.wrap.lottery{background-color: <%=lotteryBgColor%>;background-image:url(<%=lotteryBgImage%>)}#component_<%=componentId%>.wrap.lottery .chance{color: <%=chanceFontColor%>;background-color: <%=chanceBgColor%>}#component_<%=componentId%>.wrap.lottery .tbl{border-spacing: <%=tblBorderSpace%>;background-color: <%=tblBgColor%>;background-image:url(<%=tblBgImage%>)}#component_<%=componentId%>.wrap.lottery .tbl td:not(.btn-draw){box-shadow: <%=tblItemShadow%>;color: <%=tblItemFontColor%>;background-color: <%=tblItemBgColor%>}</style>\x3c!-- 滑块验证 --\x3e<div class="m-slider J_slide_wrap" id="lty_container_<%=componentId%>"><div class="mask J_slide_mask"></div><div class=container><div class=cnt><div id="lty_slider_<%=componentId%>"></div></div><div class="btn-slide J_slide_btn">立刻抽奖</div></div></div></div>',this.style='.wrap.lottery{position:relative;// width:95%;padding:0 2.5%;margin:0 auto;background-repeat:repeat;background-position:0 0;background-size:contain}.lottery .btn-prize span{display:inline-block;float:right;margin:10px;padding:1px 8px;border-radius:20px;color:#fff;background:#ffc600;font-size:13px}.lottery .chance{display:none;text-align:center;width:200px;margin:3px auto;border-radius:10px;color:#fff;background-color:#666}.lottery .chance em{padding:0 5px;color:#da3000;font-size:16px;font-weight:700}.lottery .tbl{width:100%;padding:5px;border-radius:10px;border-collapse:separate;border-spacing:8px;background-repeat:no-repeat;background-position:left top;background-size:100% 100%}.lottery table td{position:relative;width:33.333%;padding-top:30%;border-radius:10px;background-color:#fff;text-align:center;box-shadow:1px 1px 0 2px #6394b4}.lottery table td img{position:absolute;top:-20px;bottom:0;left:0;right:0;width:50%;margin:auto}.lottery table td p{position:absolute;bottom:5px;width:100%;height:20px;margin:8px auto 0;text-align:center;overflow:hidden;font-size:12px}.lottery table td.btn-draw{box-shadow:none;background:0 0}.lottery table td.btn-draw img{background-color:rgba(0,0,0,0);box-shadow:none;position:absolute;left:1px;top:3px;right:0;bottom:0;width:100%;height:100%;max-width:300px;margin:auto}.lottery td.active:after{content:"";position:absolute;left:0;top:0;width:100%;height:100%;border:3px solid #ff7910;border-radius:10px;box-sizing:border-box;-webkit-box-sizing:border-box}.lottery .m-prize{display:none;position:fixed;left:0;top:0;right:0;bottom:0;width:100%;height:100%;z-index:998}.m-prize .mask{position:absolute;width:100%;height:100%;background:rgba(0,0,0,.7)}.m-prize .list{position:relative;width:90%;height:400px;margin:25px auto;border-radius:10px;background:#fff;overflow:hidden}.m-prize .list .list-cnt{position:absolute;left:0;top:0;width:100%;height:100%;overflow-y:scroll}.m-prize .list .detail{display:flex;height:100%}.m-prize .list .desc{margin-left:5px;display:flex;flex-direction:column;justify-content:space-around}.m-prize .list .item{display:flex;justify-content:space-between;align-items:center;height:75px;padding:5px 0;border-bottom:1px solid #ccc}.m-prize .item .fig{width:85px;height:100%;flex:none;background-repeat:no-repeat;background-position:center;background-size:contain}.m-prize .item .name{max-width:140px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:14px}.m-prize .item .date{color:#676767;font-size:12px}.m-prize .item .btn{display:inline-block;margin-right:10px;padding:2px 8px;border:1px solid #7fa7c3;border-radius:5px;font-size:12px;color:#7fa7c3}.m-prize .hd{padding:15px;border-bottom:1px solid #ccc;font-size:18px;color:#666}.m-prize .ft{color:#333;text-align:center;line-height:3}.m-prize .close{position:relative;width:50px;height:50px;margin:0 auto;border:1px solid #fff;border-radius:50%}.m-prize .close::after,.m-prize .close::before{position:absolute;left:50%;top:50%;display:block;width:35px;height:1px;background:#fff;content:""}.m-prize .close::after{transform:translate(-50%) rotate(-45deg)}.m-prize .close::before{transform:translate(-50%) rotate(45deg)}.m-slider,.warning{display:none;text-align:center}.m-prize .child-wrap{height:0;overflow:hidden}.m-slider,.m-slider .mask{width:100%;height:100%;top:0;left:0}.m-prize .child-cnt{background:#eee}.m-prize .child-cnt:first-child{box-shadow:0 3px 6px 0 #ddd inset}.m-prize .child-cnt:last-child{box-shadow:0 -3px 6px 0 #ddd inset}.m-prize .child-cnt:only-child{box-shadow:0 0 6px 3px #ddd inset}.m-prize .child-cnt .name{text-overflow:inherit;white-space:normal}.m-slider{position:fixed;overflow:hidden;z-index:2000}.m-slider .mask{position:absolute;background-color:rgba(0,0,0,.7)}.m-slider .cnt{width:90%;margin:20px auto}.m-slider .container{position:absolute;width:90%;height:120px;top:0;bottom:0;left:0;right:0;margin:auto;color:#fff;background-color:#fff;border-radius:5px;overflow:hidden}.m-slider .btn-slide{height:40px;line-height:40px;background:#15a4d5;border-top:2px dotted #e8e8e8;box-sizing:border-box}.warning{width:280px;height:65px;line-height:65px;margin:0 auto;border-radius:8px;color:#fff;background:rgba(91,19,22,.7);font-size:16px}.cui-roller-btns .cui-flexbd:not(.myPopup_cancel){width:230px!important;background:#fd830c;flex:none;margin:0 auto 20px;border-radius:5px;line-height:10px;color:#fff!important}.cui-btns-cancel.myPopup_cancel{position:absolute;top:-10px;right:4px;border:none!important;width:10px;font-size:15px;transform:scale(1.2,1);color:#C1C1C1}.cui-roller-btns{border:none!important}.cui-bd{position:relative}.m-qrcode,.modalDiv{position:absolute;width:100%;height:100%;top:0}.modalDiv{right:0;z-index:999;background:0 0}.m-qrcode{display:block;left:0;z-index:1000;background:#fff;transform:translateX(100%);transition:all .3s linear;overflow-y:scroll}.carrot-d,.icon-carrot{transition:all .15s linear}.m-qrcode .back{display:flex;align-items:center;position:relative;width:70px;height:50px}.m-qrcode .back .icon-carrot{margin:0}.m-qrcode .code-wrap{display:flex;flex-direction:column;justify-content:center;align-items:center}.m-qrcode .code-wrap .desc{color:#666;font-size:12px;text-align:center}.m-qrcode .qrcode{margin:10px 0}.m-qrcode .barcode img{display:block;min-width:90%;max-width:100%}.m-qrcode .tt{text-align:center;font-weight:700}.m-qrcode .desc-wrap{padding:0 10px}.icon-carrot{position:relative;display:inline-block;width:30px;height:30px;margin:10px;transform:rotate(0)}.icon-carrot::before{content:"";position:absolute;left:50%;top:50%;display:block;width:8px;height:8px;border-top:1px solid #666;border-right:1px solid #666;-webkit-transform:translate(-50%,-50%) rotate(-45deg);-ms-transform:translate(-50%,-50%) rotate(-45deg);transform:translate(-50%,-50%) rotate(-45deg)}.carrot-d{transform:rotate(180deg)}.carrot-r{transform:rotate(90deg)}.carrot-l{transform:rotate(-90deg)}@media screen and (max-height:480px){.m-prize .list{transform:scale(.8);transform-origin:50% 0}.m-prize .close{transform:translateY(-150%)}}'+this.data.otherStyle,this.isRolling=!1,this.currentIdx=0,this.sceneCode=this.data.SceneCode||this.data.sceneCode,this.sliderObject=null,this.sliderToken=null,this.authType=null,this.data.componentId=this.$el[0].id,this.sign="",this.events={"click .J_draw":_.debounce(this.beforeDraw),"click .J_prize":_.debounce(this.togglePrizeList),"click .J_link":_.debounce(this.jump),"click .J_slide_mask":_.debounce(function(t){t.stopPropagation&&t.stopPropagation(),e.$(".J_slide_wrap").hide()}),"click .J_slide_btn":_.debounce(function(t){if(t.stopPropagation&&t.stopPropagation(),!e.sliderToken)return void Lizard.showMessage(m.NOTOKEN);e.$(".J_slide_wrap").hide(),e.draw()}),"click .J_back_prize":_.debounce(this.hideCouponCode),"click .J_item_prize":_.debounce(this.togglePromotion),"click .J_coupon_code":_.debounce(this.showCouponCode)}},awakeSlider:function(){var e=this;this.sliderObject?(this.sliderObject.clear(),this.initSlider()):window.slidingVerification&&"function"==typeof window.slidingVerification?this.initSlider():this.createSliderEle(function(){e.$(".J_slide_wrap").show(),e.initSlider()})},initSlider:function(){var e=this;this.$(".J_slide_wrap").show();var t="lty_slider_"+this.data.componentId,i="lty_container_"+this.data.componentId;this.sliderObject=new slidingVerification({id:t,appId:"100008627",containerId:i,width:"100%",height:"40px",chooseOpt:{type:"pop",position:"fixed"},businessSite:"sms_activity_h5",resultHandler:function(t){e.sliderToken=t.token},stateChange:function(e){0==e&&d("slide show")}})},createSliderEle:function(e){var t=document.createElement("script");t.src="//"+{fat:"webresource.fws.qa.nt.ctripcorp.com",uat:"webresource.uat.qa.nt.ctripcorp.com",pro:"webresource.c-ctrip.com"}[function(){var e=location.host;return e.match(/localhost|127\.0|\.fat\d*\.qa\.nt\.ctripcorp\.com|ctriptravel\.com/i)?"fat":e.match(/\.uat\.qa\.nt\.ctripcorp\.com/i)?"uat":"pro"}()]+"/ares/infosec/captcha/*/default/js/captcha.min.js",t.onload=function(){e&&e()},document.head.appendChild(t)},onRender:function(){var e=this;this.fetchStatus(this.sceneCode,function(t){0===t.code?e.renderPrize():e.renderErrorWarn(t.code)})},renderPrize:function(){var e=this,t=this,i=[[0,1,2],[7,-1,3],[6,5,4]];t.fetchPrize(this.sceneCode,function(o){var r=o.code,n=o.prizeInfos,a=o.sceneInfo;if(0===r){var s=i.map(function(t){return t.map(function(t){var i={},o="";if(-1!==t){i=n[t];try{o=JSON.parse(i.extension).url}catch(e){o=x.Holder}i.imgurl=o,i.idx=t,i.className="item"}else{i={name:"",code:"",imgurl:e.data.centerBtnImage?e.data.centerBtnImage:"//images3.c-ctrip.com/marketing/front/component/luckydraw/draw_btn.png",idx:"draw",className:"J_draw btn-draw"}}return i})}),d=_.template('<tbody> <%_.each(prizeList, function(row) {%> <tr> <% _.each(row, function(item, index){ %> <td class="<%=item.className%>" data-code="<%=item.code%>" data-idx="<%=item.idx%>" id="mktact_lottery_item_<%=item.idx%>"><img class="" src="<%=item.imgurl%>"><p><%=item.name%></p></td> <%})%> </tr> <%})%> </tbody>',{prizeList:s});t.$(".J_tbl").html(d),e.authType=a.verifyType}else t.errorHandler(r)})},beforeDraw:function(){if(!p)return void this.errorHandler(f.USER_NOT_LOGIN);this.isRolling||(3==this.authType?this.awakeSlider():this.draw())},draw:function(){var e=this;this.isRolling||(this.isRolling=!0,Lizard.showLoading(),e.join(this.sceneCode,this.sliderToken,function(t){var o=t.code,r=t.cause,n=(t.message,t.prizeInfo),a=void 0===n?{}:n;if(e.sliderToken="",Lizard.hideLoading(),0===o){var s=e.$(".lottery .item").filter("[data-code='"+a.code+"']").data("idx"),c=a.prizeType,l={};try{l=JSON.parse(a.custom||"{}")}catch(e){d("parse prize custom error:",e)}if(-1===s||isNaN(s))return d("sotp index error:",s),Lizard.showMessage(m.ERROR),void(e.isRolling=!1);2===c&&e.fetchSign(e.sceneCode,function(t){var i=t.code,o=t.signature;0===i?e.sign=o:d("签名获取失败:",t)}),e.roll(Number(s),function(){e.isRolling=!1,e.resultHandler("success",function(){if(2===c)e.sign?Lizard.jump(e.getAddress(),{targetModel:2}):Lizard.showMessage(m.ERROR);else if(1===c)l.rst_url&&Lizard.jump(l.rst_url,{targetModel:2});else if(3===c){var t=l.authUrl||"",o=l.rst_url||"";t&&i.isInWechat()?Lizard.jump(t,{targetModel:2}):!!o&&Lizard.jump(l.rst_url,{targetModel:2})}},a)})}else e.isRolling=!1,e.errorHandler(o,r)}))},roll:function(e,t){var i=this,o=this.$(".lottery .item"),r=o.length,n=this.currentIdx,a=e%8,s=0,d=g.cycle,c=g.speed,l=null,p=function e(){if(s++,n>r-2?n=0:n++,o.removeClass("active").filter('[data-idx="'+n+'"]').addClass("active"),s>d)if(s<d+r)c+=20;else if(n===a)return clearTimeout(l),a=-1,i.currentIdx=n,c=g.speed,void(t&&t());l=setTimeout(e,c)};l=setTimeout(p,c)},togglePrizeList:function(){var e=this,t=this.$(".J_prize_list");if("none"==t.css("display")){var o=function(){e.fetchJoinList(e.sceneCode,function(t){d("join list",t);var o=t.code,r=t.recordInfos,n=void 0===r?[]:r;if(0===o){var a=n.map(function(t){var o={},r={},n={};try{r=JSON.parse(t.prizeInfo.extension||"{}"),n=JSON.parse(t.prizeInfo.custom||"{}")}catch(e){d("parse prizeList ext/cus error",e)}var a=t.prizeInfo.prizeType;return o.fig=r.url||x.Holder,o.name=t.prizeInfo.name,o.date=i.formatDate(t.joinTime,"yyyy-mm-dd"),o.btn=n.btnText||"去查看",o.url=n.rst_url||"",o.appurl=n.appUrl,o.wxurl=n.wxUrl,2===a&&(o.btn="填写地址",o.url=e.getAddress()),o.isBtn=!!o.url,1==a&&(o.isMore=!0,o.isBtn=!1,o.promotion=t.prizeInfo.promotionCode),o}),s=_.template('<div class=mask></div><div class="list J_prize_cnt"><div class=list-cnt><div class=hd>我的奖品</div><ul> <%_.each(prizeList, function(item) {%> <li class=J_parent_cnt><div class=item><div class=detail><div class=fig style="background-image:url(<%=item.fig%>)"></div><div class=desc><p class=name><%=item.name%></p><p class=date><%=item.date%></p></div></div> <%if(item.isBtn) {%> <a href=javascript:; class="btn J_link" data-url="<%=item.url%>"><%=item.btn%></a> <%}%> <%if(item.isMore) { %> <span class="icon-carrot J_item_prize" data-promotion="<%=item.promotion%>" data-url="<%=item.url%>" data-appurl="<%=item.appurl%>" data-wxurl="<%=item.wxurl%>" data-btn="<%=item.btn%>"></span> <%}%> </div><div class="J_child_cnt child-wrap"></div></li> <%})%> </ul><div class=ft>没有更多了</div></div><div class="m-qrcode J_qrcode"><div class="back J_back_prize"><span class="icon-carrot carrot-l"></span> <span>返回</span></div><div class=code-wrap><div class=desc>如需用券，请向商家展示二维码</div><div id=qrcode class=qrcode></div><div class=desc>如需用券，请向商家展示条形码</div><div class=barcode><img id=barcode></div><div class=J_couponcode></div></div><div class="desc-wrap J_coupon_desc"></div></div></div><div class="close J_prize"></div>',{prizeList:a});e.$(".J_prize_list").html(s)}else e.errorHandler(o)})};if(!p)return void e.errorHandler(f.USER_NOT_LOGIN);e.sign?o():e.fetchSign(e.sceneCode,function(t){var i=t.code,r=t.signature;d("sign",t),0===i&&(e.sign=r),o()})}else e.$(".J_prize_list").html("");t.toggle()},togglePromotion:function(e){var t=this,i=this.$(e.target),o=i.parent().siblings(".J_child_cnt"),r=i.data("promotion"),n=i.data("url")||"https://m.ctrip.com",a=i.data("btn"),s=function(){var e=o.find(".item"),t=e.height()*e.length;i.addClass("carrot-d"),o.animate({height:t},150)};return o.height()>0?(i.removeClass("carrot-d"),void o.animate({height:0},150)):o.html()?void s():void(r&&this.fetchPromotionList(r,function(e){var i=e.code,c=e.childPrizeInfos,l=void 0===c?[]:c;if(0===i){var p=l.map(function(e){var t={},i={},o={};try{i=JSON.parse(e.extension||"{}"),JSON.parse(e.custom||"{}"),o=JSON.parse(e.property||"{}")}catch(e){d("parse prizeList ext/cus error",e)}return t.name=e.name,t.code=e.code,t.proCode=r,t.isThirdCoupon="ThirdCoupon"===e.type,t.fig=i.iconSrc||x[e.type]||x.Holder,t.btn=i.btnText||a,t.isThirdCoupon&&(t.btn="立即使用",t.proId=o.promotionId||""),t.url=i.viewUrl||n,t.wxurl=i.wxUrl||"",t.appurl=i.appUrl||"",t}),u=_.template('<%_.each(prizeList, function(item) {%> <div class="item child-cnt"><div class=detail><div class=fig style="background-image:url(<%=item.fig%>)"></div><div class=desc><p class=name> <%=item.name%> </p></div></div> <%if(item.isThirdCoupon) {%> <a href=javascript:; class="btn J_coupon_code" data-code="<%=item.code%>" data-procode="<%=item.proCode%>" data-proid="<%=item.proId%>"> <%=item.btn%></a> <%} else {%> <a href=javascript:; class="btn J_link" data-url="<%=item.url%>" data-appurl="<%=item.appurl%>" data-wxurl="<%=item.wxurl%>"> <%=item.btn%></a> <%}%> </div> <%})%> \x3c!-- <span class="icon-carrot carrot-r J_coupon_code" data-code="" data-procode=""></span> --\x3e',{prizeList:p});o.html(u),s()}else t.errorHandler(i)}))},initCode:function(e){QRCode&&(this.$("#qrcode").html(""),new QRCode(document.getElementById("qrcode"),{text:e,width:180,height:180,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H})),JsBarcode&&(this.$("#barcode").html(""),JsBarcode(document.getElementById("barcode"),e,{fontSize:14,width:2,height:50,displayValue:!1})),this.$(".J_couponcode").html("兑换码："+e)},showCouponCode:function(e){var t=this,i=this,o=this.$(e.currentTarget),r=o.parents(".J_parent_cnt").find(".J_item_prize"),n=o.data("procode").toString(),a=o.data("code"),s=o.data("proid");d(s,"proId"),s&&this.fetchPromotionDetail(s,function(e){if(e&&0===e.resultCode){var i=e.promotionDesc||"",o=e.linkUrl;if(o)Lizard.jump(o,{targetModel:2});else{if(i){t.$(".J_coupon_desc").hide().html('<div class="tt">使用说明</div><div>'+i.toString().replace(/<\/?script>/g,"")+"</div>").show()}c()}}});var c=function(){t.fetchAwardList(n,function(e){var o=e.code,s=e.prizeRecords,c=void 0===s?[]:s;if(0===o){var l=c.filter(function(e){return e.prizeCode==a});if(d(c,l,"codearr"),l.length){var p="",u=$(".J_item_prize[data-promotion="+n+"]");d("current index:",u.index(r),r,u);var h=u.index(r);if(!(p=h>-1&&l[h]?l[h].serialCode:l[0].serialCode))return void Lizard.showMessage(m.NOSERIAL);i.initCode(p),t.$(".J_qrcode").css({transform:"translateX(0)"}),t.$(".J_prize_cnt").css({overflowY:"hidden"})}else Lizard.showMessage(m.NOSERIAL)}else i.errorHandler(o)})}},hideCouponCode:function(e){this.$(".J_qrcode").css({transform:"translateX(100%)"}),this.$(".J_prize_cnt").css({overflowY:"scroll"})},errorHandler:function(e,t){switch(e){case f.UNDERSTOCK:this.resultHandler("understock");break;case f.UNBOUND_MOBILE:this.resultHandler("bindMobile",function(){i.isInCtrip()?Lizard.jump("/webapp/myinfo/bindphone?action=set&phone=&from="+encodeURIComponent(location.href),{targetModel:4}):Lizard.jump("https://m.ctrip.com/webapp/h5myinfo/bindphone?action=set&from="+encodeURIComponent(location.href))});break;case f.USER_NOT_LOGIN:this.resultHandler("needLogin",function(){if(l&&!l.isLogin())return void r.memberLogin({param:"from="+encodeURIComponent(location.href),callback:function(){}})});break;case f.RULE_CHECK_FAILED:if(t){var o=JSON.parse(t||"[]");if(o[0]&&"AppOnly"===o[0].ruleType)return void this.showResult("去携程app","此券需要去携程app领券哦",function(){i.activateApp(location.href,!0)})}this.resultHandler("notQulified");break;case f.USER_DUPLICATE_JOIN:case f.CLIENT_DUPLICATE_JOIN:case f.MOBILE_DUPLICATE_JOIN:this.resultHandler("duplicate");break;case f.DAY_DUPLICATE:this.resultHandler("dayDuplicate");break;case f.WEEK_DUPLICATE:this.resultHandler("weekDuplicate");break;case f.MONTH_DUPLICATE:this.resultHandler("MonthDuplicate");break;case f.NOT_QULIFIED:this.resultHandler("notQulified");break;default:this.resultHandler("fail",function(){Lizard.jump(location.href)}),d("fail code:",e)}},resultHandler:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o="success"===e,r=i.prizeType,n=e;o&&(n="getPrize_"+r);var a=g[n+"_text"]||g.btnTxt,s=g[n+"_info"];o&&0!==r&&(s=s+'<p class="">'+i.name+"</p>"),this.showResult(a,s,t)},showResult:function(e,t,i){this.root.showMessage({datamodel:{btns:[{name:e,className:"cui-btns-ok myPopup_ok"},{name:"x",className:"cui-btns-cancel myPopup_cancel"}],content:t},okAction:function(){this.hide(),"function"==typeof i&&i()},cancelAction:function(){this.hide()},maskToHide:!0})},wakeUpJump:function(e){if(e)try{i.isInCtrip()?Lizard.jump(e,{targetModel:2}):i.activateApp(e,!0)}catch(e){d("wakeUpJump error:",e)}},jump:function(e){var t=this.$(e.currentTarget),o=t.data("url").toString(),r=t.data("appurl"),a=t.data("wxurl");if(h()&&a){o=a;try{n.weiXinGlobal.ping().done(function(){n.weiXinGlobal().done(function(e){e.miniProgram.navigateTo({url:o})})})}catch(e){console.log("get wx failed",e)}}else i.isInCtrip()&&r&&(o=r),(o=o+(o.indexOf("?")>-1?"&":"?")+"from="+encodeURIComponent(location.href))&&Lizard.jump(o,{targetModel:2})},getAddress:function(){return this.sign?location.origin+"/huodong/useraddress/index?allianceid="+this.basic().aid+"&sid="+this.basic().sid+"&signature="+this.sign:""},renderErrorWarn:function(e){var t=m.SCENE_ERROR[e]||m.ERROR;this.$("#container_"+this.data.componentId).remove(),this.$("#warn_"+this.data.componentId).text(t+" "+e).show()},fetch:function(e){return this.buildSoa(this.basic().SOA_PORT,e,this.basic().ENV)},fetchSign:function(e,t){var i=this.fetch("generateSign");i.setParam({sceneCode:e,aid:this.basic().aid.toString(),sid:this.basic().sid.toString()}),i.execute(function(e){t&&t(e)},function(e){d("签名获取异常",e)})},fetchStatus:function(e,t){var i=this.fetch("queryStatus");i.setParam({sceneCode:e}),i.execute(function(e){t&&t(e)},function(e){Lizard.showMessage(m.ERROR),d("活动状态异常",e)})},fetchPrize:function(e,t){var i=this.fetch("queryPrizeInfo");i.setParam({sceneCode:e}),i.execute(function(e){t&&t(e)},function(e){Lizard.showMessage(m.ERROR),d("queryPrizeInfo异常",e)})},join:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments[2],o=this.fetch("join");o.setParam({sceneCode:e,token:t,allianceInfo:{aid:c.aid.toString(),ouid:c.ouid.toString(),pushCode:c.pushcode.toString(),sid:c.sid.toString()},extension:{vid:"",fingerPrint:"",rmsToken:"",requestUrl:""}}),o.execute(function(e){d("join:",e),i&&i(e)},function(e){Lizard.showMessage(m.ERROR),d("join异常",e)})},fetchJoinList:function(e,t){var i=this.fetch("queryJoinList");i.setParam({sceneCode:e}),i.execute(function(e){t&&t(e)},function(e){Lizard.showMessage(m.ERROR),d("queryJoinList异常",e)})},fetchPromotionList:function(e,t){var i=this.fetch("queryPromotionInfo");i.setParam({promotionCode:e,pageNo:1,pageSize:10,identifier:""}),i.execute(function(e){t&&t(e)},function(e){Lizard.showMessage(m.ERROR),d("queryPromotionInfo异常",e)})},fetchAwardList:function(e,t){var i=this.fetch("queryAwardList");i.setParam({identifier:"",promotionCode:e,pageNo:1,pageSize:10}),i.execute(function(e){t&&t(e)},function(e){Lizard.showMessage(m.ERROR),d("queryAwardList异常",e)})},fetchPromotionDetail:function(e,t){var i=this.buildSoa("13018","getpromotioninfo",this.basic().ENV);i.setParam({promotionCode:e}),i.execute(function(e){t&&t(e)},function(e){Lizard.showMessage(m.ERROR),d("getPromotionInfo异常",e)})}})});